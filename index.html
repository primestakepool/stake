<div id="wallets-container" style="text-align:center;margin-top:20px;">
  <h3>Select your wallet to delegate:</h3>
  <div id="walletButtons"></div>
  <button id="delegateBtn" style="padding:10px 18px;font-size:16px;display:none;margin-top:15px;">
    Delegate to Pool
  </button>
</div>

<script>
(async function() {
  const POOL_ID = "pool1w2duw0lk7lxjpfqjguxvtp0znhaqf8l2yvzcfd72l8fuk0h77gy";  // üîÅ Replace with your real pool ID
  const NETWORK_ID = 1;           // 1 = mainnet
  let selectedWalletName = null;
  let api = null;

  function getAvailableWallets() {
    if (!window.cardano) return {};
    const wallets = {};
    for (const name of Object.keys(window.cardano)) {
      const wallet = window.cardano[name];
      if (wallet && typeof wallet.enable === "function") wallets[name] = wallet;
    }
    return wallets;
  }

  function renderWalletButtons() {
    const container = document.getElementById("walletButtons");
    container.innerHTML = "";
    const wallets = getAvailableWallets();

    console.log("Detected wallets:", Object.keys(wallets)); // üëà debug log

    if (Object.keys(wallets).length === 0) {
      container.innerHTML = "<p>No Cardano wallet found. Please refresh after unlocking your wallet.</p>";
      return;
    }

    for (const name of Object.keys(wallets)) {
      const btn = document.createElement("button");
      btn.textContent = "Connect " + name;
      btn.style.margin = "5px";
      btn.style.padding = "10px 16px";
      btn.style.fontSize = "15px";
      btn.onclick = () => connectWallet(name);
      container.appendChild(btn);
    }
  }

  async function connectWallet(name) {
    try {
      selectedWalletName = name;
      api = await window.cardano[name].enable();
      const net = await api.getNetworkId();
      if (net !== NETWORK_ID) {
        alert("Please switch your wallet to mainnet.");
        return;
      }
      document.getElementById("delegateBtn").style.display = "inline-block";
      alert("Connected to " + name + "!");
    } catch (err) {
      console.error(err);
      alert("Connection failed: " + err.message);
    }
  }

  async function delegateToPool() {
    if (!api || !selectedWalletName) {
      alert("Please connect a wallet first.");
      return;
    }

    try {
      const usedAddr = (await api.getUsedAddresses())[0];
      const rewardAddr = (await api.getRewardAddresses())[0];
      console.log("Delegating from:", usedAddr);
      console.log("Reward address:", rewardAddr);

      alert(`Wallet ready to delegate to pool:\n${POOL_ID}\n\nNext: implement transaction build.`);
    } catch (err) {
      console.error(err);
      alert("Delegation failed: " + err.message);
    }
  }

  document.getElementById("delegateBtn").addEventListener("click", delegateToPool);
  renderWalletButtons();
})();
</script>
